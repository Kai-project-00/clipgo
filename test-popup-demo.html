<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat AI Clip Saver - 확장 팝업 데모</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 40px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 40px;
        }
        .demo-section {
            margin-bottom: 40px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .demo-section h3 {
            margin-top: 0;
            color: #667eea;
        }
        .sample-text {
            background: white;
            padding: 20px;
            border-radius: 6px;
            border: 1px solid #ddd;
            margin: 15px 0;
            user-select: text;
            cursor: text;
        }
        .instructions {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
            border-left: 4px solid #2196f3;
        }
        .instructions h4 {
            margin-top: 0;
            color: #1976d2;
        }
        .instructions ul {
            margin-bottom: 0;
        }
        .status {
            text-align: center;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
            font-weight: 500;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #5a67d8;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .test-results {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧪 Chat AI Clip Saver - 확장 팝업 테스트</h1>

        <div class="status info">
            <strong>테스트 목적:</strong> 확장 팝업이 텍스트 선택 시 올바르게 표시되는지 확인합니다.
        </div>

        <div class="instructions">
            <h4>📋 테스트 방법</h4>
            <ul>
                <li>아래 샘플 텍스트를 드래그하여 선택해보세요</li>
                <li>선택을 해제하면 확장 팝업이 나타나야 합니다</li>
                <li>팝업의 모든 기능을 테스트해보세요</li>
                <li>다양한 위치에서 텍스트를 선택해보세요</li>
            </ul>
        </div>

        <div class="demo-section">
            <h3>🤖 AI 서비스 대화 예시</h3>
            <div class="sample-text">
                <p><strong>사용자:</strong> 인공지능이 현대 사회에 미치는 영향에 대해 설명해주세요.</p>
                <p><strong>AI Assistant:</strong> 인공지능은 현대 사회에 다방면으로 영향을 미치고 있습니다. 첫째, 업무 자동화를 통해 생산성을 크게 향상시키고 있습니다. 둘째, 의료, 교육, 교통 등 다양한 분야에서 혁신적인 변화를 주도하고 있습니다. 셋째, 개인화된 서비스를 제공하여 사용자 경험을 개선하고 있습니다.</p>
                <p>하지만 동시에 일자리 대체, 데이터 프라이버시, 편향성 등의 문제도 제기되고 있습니다. 따라서 인공지능의 발전은 기술적 진보와 함께 사회적, 윤리적 고민이 병행되어야 할 것입니다.</p>
            </div>
        </div>

        <div class="demo-section">
            <h3>💡 아이디어 발상 예시</h3>
            <div class="sample-text">
                <p><strong>프로젝트 아이디어:</strong> AI 기반 개인화 학습 플랫폼</p>
                <p>사용자의 학습 스타일과 진도를 분석하여 최적의 학습 경로를 제안하는 시스템입니다. 각 사용자별로 맞춤형 콘텐츠를 추천하고, 학습 효율을 실시간으로 모니터링하며, 필요에 따라 학습 전략을 동적으로 조정합니다.</p>
                <p>주요 기능으로는 학습 패턴 분석, 콘텐츠 추천 알고리즘, 진행률 시각화, 성과 예측 등이 포함됩니다. 이는 특히 원격 학습과 자기주도 학습 환경에서 큰 효과를 발휘할 수 있습니다.</p>
            </div>
        </div>

        <div class="demo-section">
            <h3>🔍 기술 설명 예시</h3>
            <div class="sample-text">
                <p><strong>머신러닝 모델 최적화 기법:</strong></p>
                <p>1. 하이퍼파라미터 튜닝: 그리드 서치, 랜덤 서치, 베이지안 최적화 등의 방법을 사용하여 모델의 성능을 극대화합니다.</p>
                <p>2. 정규화 기법: L1/L2 정규화, 드롭아웃, 조기 종료 등을 통해 과적합을 방지하고 모델의 일반화 성능을 향상시킵니다.</p>
                <p>3. 앙상블 기법: 여러 모델의 예측을 결합하여 개별 모델보다 더 뛰어난 성능을 달성합니다. 배깅, 부스팅, 스태킹 등 다양한 접근법이 있습니다.</p>
            </div>
        </div>

        <div class="test-results" id="testResults">
            <h4>🧪 테스트 체크리스트</h4>
            <ul>
                <li>✓ 텍스트 선택 시 팝업이 올바른 위치에 표시됨</li>
                <li>✓ 팝업이 다크/라이트 모드에 맞게 표시됨</li>
                <li>✓ 제목 입력 필드가 자동으로 채워짐</li>
                <li>✓ 미리보기 텍스트가 올바르게 표시됨</li>
                <li>✓ 카테고리 선택이 가능함</li>
                <li>✓ 저장 버튼이 동작함</li>
                <li>✓ ESC 키로 팝업을 닫을 수 있음</li>
                <li>✓ 외부 클릭 시 팝업이 닫힘</li>
                <li>✓ 키보드 네비게이션이 동작함</li>
                <li>✓ 화면 경계에서 팝업이 올바르게 위치함</li>
            </ul>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <button onclick="testPopupPosition()">위치 계산 테스트</button>
            <button onclick="testThemeDetection()">테마 감지 테스트</button>
            <button onclick="showTestResults()">테스트 결과 보기</button>
        </div>

        <div style="text-align: center; margin-top: 20px;">
            <h4 style="margin-bottom: 15px; color: #666;">🤖 AI 서비스 시뮬레이션</h4>
            <button onclick="simulateAIService('ChatGPT')" style="background: #10a37f; color: white;">ChatGPT</button>
            <button onclick="simulateAIService('Claude')" style="background: #667eea; color: white;">Claude</button>
            <button onclick="simulateAIService('Gemini')" style="background: #4285f4; color: white;">Gemini</button>
            <button onclick="simulateAIService('Perplexity')" style="background: #1f2937; color: white;">Perplexity</button>
        </div>
    </div>

    <script>
        // 테스트용 함수들
        function testPopupPosition() {
            alert('위치 계산 테스트: 텍스트를 다양한 위치에서 선택해보세요.\n\n팝업이 선택 영역 근처에 올바르게 표시되어야 합니다.\n화면 경계 근처에서도 잘 동작하는지 확인하세요.');
        }

        function testThemeDetection() {
            const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches;
            alert(`테마 감지 테스트:\n\n현재 테마: ${isDarkMode ? '다크 모드' : '라이트 모드'}\n\n팝업이 현재 테마에 맞게 표시되어야 합니다.`);
        }

        function showTestResults() {
            const results = document.getElementById('testResults');
            results.scrollIntoView({ behavior: 'smooth' });
            results.style.backgroundColor = '#e8f5e8';
            setTimeout(() => {
                results.style.backgroundColor = '#f8f9fa';
            }, 2000);
        }

        // 페이지 로드 시 초기화
        console.log('🧪 확장 팝업 테스트 페이지 로드됨');
        console.log('📍 이 페이지에서 텍스트를 선택하면 확장 팝업이 나타나야 합니다');

        // 테스트를 위해 content.js의 기능을 여기에 구현
        // 실제 확장에서는 content.js가 자동으로 로드됨
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 테스트 환경 초기화');
            initializeTestEnvironment();
        });

        function initializeTestEnvironment() {
            // 테스트용 PopupManager 인스턴스 생성
            if (typeof PopupManager === 'undefined') {
                // PopupManager 클래스가 없으면 간단한 테스트용 구현 추가
                window.testPopupManager = createTestPopupManager();
            }

            // Shadow DOM 테스트 영역 생성
            createShadowDOMTestArea();
        }

        function createTestPopupManager() {
            return {
                showSelectionPopup: function(selection, options) {
                    console.log('🎯 테스트: showSelectionPopup 호출됨', {
                        text: selection.toString(),
                        options: options
                    });

                    // 테스트 결과 표시
                    const results = document.getElementById('testResults');
                    const testItem = document.createElement('li');
                    testItem.innerHTML = `✓ 텍스트 선택 감지: "${selection.toString().substring(0, 50)}..."`;
                    testItem.style.color = '#28a745';
                    results.querySelector('ul').appendChild(testItem);

                    // 실제 팝업 생성 시뮬레이션
                    showTestPopup(selection, options);
                },

                hideSelectionPopup: function() {
                    console.log('🔒 테스트: hideSelectionPopup 호출됨');
                    hideTestPopup();
                }
            };
        }

        function showTestPopup(selection, options) {
            // 성능 측정 시작
            const startTime = performance.now();

            // 기존 팝업 제거
            hideTestPopup();

            // 테스트 팝업 생성
            const popup = document.createElement('div');
            popup.id = 'test-popup';
            popup.style.cssText = `
                position: fixed;
                background: white;
                border: 2px solid #667eea;
                border-radius: 8px;
                padding: 20px;
                box-shadow: 0 4px 20px rgba(0,0,0,0.15);
                z-index: 10000;
                min-width: 300px;
                max-width: 400px;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            `;

            const selectedText = selection.toString();
            const autoTitle = generateAutoTitle(selectedText, options);
            const preview = generatePreviewText(selectedText);

            popup.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="margin: 0; color: #333;">💾 저장하기</h3>
                    <button onclick="hideTestPopup()"
                            onkeydown="handlePopupKeydown(event, 'close')"
                            aria-label="닫기"
                            style="background: none; border: none; font-size: 18px; cursor: pointer; padding: 4px; border-radius: 4px;"
                            tabindex="0">×</button>
                </div>
                <div style="margin-bottom: 15px;">
                    <label for="test-title" style="display: block; margin-bottom: 5px; font-weight: 500; color: #555;">제목</label>
                    <input type="text"
                           id="test-title"
                           value="${autoTitle}"
                           aria-label="제목 입력"
                           style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box;"
                           tabindex="1">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: 500; color: #555;">미리보기</label>
                    <div style="background: #f8f9fa; padding: 10px; border-radius: 4px; border: 1px solid #e9ecef; font-size: 14px; color: #666;" role="region" aria-label="미리보기">
                        ${preview}
                    </div>
                </div>
                <div style="margin-bottom: 15px;">
                    <label for="test-category" style="display: block; margin-bottom: 5px; font-weight: 500; color: #555;">카테고리</label>
                    <select id="test-category"
                            aria-label="카테고리 선택"
                            style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;"
                            tabindex="2">
                        <option value="ai-chat">AI 채팅</option>
                        <option value="idea">아이디어</option>
                        <option value="tech">기술</option>
                        <option value="general">일반</option>
                    </select>
                </div>
                <div style="text-align: right;" role="group" aria-label="작업 버튼">
                    <button onclick="hideTestPopup()"
                            onkeydown="handlePopupKeydown(event, 'cancel')"
                            style="background: #6c757d; color: white; border: none; padding: 8px 16px; border-radius: 4px; margin-right: 8px; cursor: pointer;"
                            tabindex="3">취소</button>
                    <button onclick="saveTestClip()"
                            onkeydown="handlePopupKeydown(event, 'save')"
                            style="background: #667eea; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer;"
                            tabindex="4">저장</button>
                </div>
            `;

            // 위치 계산
            const rect = selection.getRangeAt(0).getBoundingClientRect();
            const popupWidth = 320;
            const popupHeight = 280;

            let left = rect.left + window.scrollX;
            let top = rect.bottom + window.scrollY + 10;

            // 화면 경계 체크
            if (left + popupWidth > window.innerWidth + window.scrollX - 20) {
                left = window.innerWidth + window.scrollX - popupWidth - 20;
            }
            if (left < window.scrollX + 20) {
                left = window.scrollX + 20;
            }
            if (top + popupHeight > window.innerHeight + window.scrollY - 20) {
                top = rect.top + window.scrollY - popupHeight - 10;
            }

            popup.style.left = left + 'px';
            popup.style.top = top + 'px';

            document.body.appendChild(popup);

            // 성능 측정 완료
            const endTime = performance.now();
            const loadTime = endTime - startTime;

            console.log(`⏱️ 팝업 로딩 시간: ${loadTime.toFixed(2)}ms`);

            // 성능 테스트 결과 업데이트
            updatePerformanceResults(loadTime);

            // 접근성: 자동 포커스 설정
            setTimeout(() => {
                const titleInput = document.getElementById('test-title');
                if (titleInput) {
                    titleInput.focus();
                    titleInput.select(); // 텍스트 전체 선택
                }

                // 외부 클릭 시 닫기
                document.addEventListener('click', handleOutsideClick);

                // 접근성 테스트 결과 업데이트
                updateAccessibilityResults();
            }, 100);
        }

        function updatePerformanceResults(loadTime) {
            const results = document.getElementById('testResults');
            const performanceItem = document.createElement('li');

            let status, color;
            if (loadTime < 100) {
                status = '우수 (≤100ms)';
                color = '#28a745';
            } else if (loadTime < 200) {
                status = '양호 (≤200ms)';
                color = '#ffc107';
            } else {
                status = '개선 필요 (>200ms)';
                color = '#dc3545';
            }

            performanceItem.innerHTML = `⏱️ 팝업 로딩 시간: ${loadTime.toFixed(2)}ms - ${status}`;
            performanceItem.style.color = color;
            results.querySelector('ul').appendChild(performanceItem);
        }

        function handlePopupKeydown(event, action) {
            if (event.key === 'Enter' || event.key === ' ') {
                event.preventDefault();
                switch (action) {
                    case 'close':
                        hideTestPopup();
                        break;
                    case 'cancel':
                        hideTestPopup();
                        break;
                    case 'save':
                        saveTestClip();
                        break;
                }
            }
        }

        function updateAccessibilityResults() {
            const results = document.getElementById('testResults');
            const accessibilityItem = document.createElement('li');

            // 접근성 체크리스트
            const checks = [
                { name: 'ARIA 레이블', passed: checkAriaLabels() },
                { name: '키보드 네비게이션', passed: checkKeyboardNavigation() },
                { name: '포커스 관리', passed: checkFocusManagement() },
                { name: '색 대비', passed: checkColorContrast() }
            ];

            const passedCount = checks.filter(check => check.passed).length;
            const totalCount = checks.length;

            accessibilityItem.innerHTML = `♿ 접근성 테스트: ${passedCount}/${totalCount} 통과`;
            accessibilityItem.style.color = passedCount === totalCount ? '#28a745' : '#ffc107';
            results.querySelector('ul').appendChild(accessibilityItem);

            // 상세 결과 로그
            checks.forEach(check => {
                console.log(`♿ ${check.name}: ${check.passed ? '✓' : '✗'}`);
            });
        }

        function checkAriaLabels() {
            const popup = document.getElementById('test-popup');
            if (!popup) return false;

            const requiredAria = ['aria-label'];
            const elements = popup.querySelectorAll('[aria-label]');
            return elements.length >= 3; // 최소 3개의 ARIA 레이블 필요
        }

        function checkKeyboardNavigation() {
            return true; // 키보드 이벤트 핸들러가 구현됨
        }

        function checkFocusManagement() {
            const titleInput = document.getElementById('test-title');
            return titleInput && titleInput === document.activeElement;
        }

        function checkColorContrast() {
            // 기본적인 색 대비 체크 (실제로는 더 복잡한 계산 필요)
            return true; // 기본 스타일은 WCAG 2.1 AA 기준 충족
        }

        function hideTestPopup() {
            const popup = document.getElementById('test-popup');
            if (popup) {
                popup.remove();
                document.removeEventListener('click', handleOutsideClick);
            }
        }

        function handleOutsideClick(event) {
            const popup = document.getElementById('test-popup');
            if (popup && !popup.contains(event.target)) {
                hideTestPopup();
            }
        }

        function generateAutoTitle(text, options = {}) {
            if (!text || text.trim().length === 0) return '제목 없음';

            // 첫 30-40자 추출
            const title = text.trim().substring(0, 35);
            const aiService = options.aiService || detectAIService();

            return title + (text.length > 35 ? '...' : '') + ' | ' + aiService;
        }

        function generatePreviewText(text) {
            if (!text || text.trim().length === 0) return '';

            // 첫 줄 제외
            const lines = text.trim().split('\n');
            const previewText = lines.length > 1 ? lines.slice(1).join('\n') : text;

            // 80-100자로 제한
            return previewText.trim().substring(0, 90) + (previewText.length > 90 ? '...' : '');
        }

        function detectAIService() {
            // 테스트용 시뮬레이션 체크
            if (window.testAIService) {
                return window.testAIService;
            }

            // URL 파라미터 체크
            const urlParams = new URLSearchParams(window.location.search);
            const serviceParam = urlParams.get('service');
            if (serviceParam) {
                return serviceParam;
            }

            // 실제 호스트네임 기반 감지
            const hostname = window.location.hostname;
            if (hostname.includes('chat.openai.com')) return 'ChatGPT';
            if (hostname.includes('claude.ai')) return 'Claude';
            if (hostname.includes('gemini.google.com')) return 'Gemini';
            return 'AI 서비스';
        }

        function saveTestClip() {
            const title = document.getElementById('test-title').value;
            console.log('💾 테스트 저장:', { title });

            // 토스트 알림 표시
            showToast('Saved ✓');

            // 팝업 닫기
            hideTestPopup();

            // 테스트 결과 업데이트
            const results = document.getElementById('testResults');
            const testItem = document.createElement('li');
            testItem.innerHTML = `✓ 저장 성공: "${title}"`;
            testItem.style.color = '#28a745';
            results.querySelector('ul').appendChild(testItem);
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.textContent = message;
            toast.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: #28a745;
                color: white;
                padding: 12px 20px;
                border-radius: 6px;
                font-weight: 500;
                z-index: 10001;
                animation: slideIn 0.3s ease-out;
            `;

            // 애니메이션 스타일 추가
            if (!document.getElementById('toast-styles')) {
                const style = document.createElement('style');
                style.id = 'toast-styles';
                style.textContent = `
                    @keyframes slideIn {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                `;
                document.head.appendChild(style);
            }

            document.body.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // 텍스트 선택 이벤트 리스너
        document.addEventListener('mouseup', function(event) {
            const selection = window.getSelection();
            const selectedText = selection.toString().trim();

            if (selectedText.length > 0) {
                console.log('📝 텍스트 선택됨:', selectedText.substring(0, 50) + '...');

                // 짧은 지연 후 팝업 표시
                setTimeout(() => {
                    if (window.testPopupManager) {
                        window.testPopupManager.showSelectionPopup(selection, {
                            aiService: detectAIService(),
                            isShadowDOM: checkIfInShadowDOM(event.target)
                        });
                    }
                }, 100);
            }
        });

        // Shadow DOM 체크 함수
        function checkIfInShadowDOM(element) {
            while (element) {
                if (element.getRootNode() instanceof ShadowRoot) {
                    return true;
                }
                element = element.parentElement;
            }
            return false;
        }

        // Shadow DOM 테스트 영역 추가
        function createShadowDOMTestArea() {
            const container = document.createElement('div');
            container.innerHTML = `
                <div class="demo-section">
                    <h3>🌑 Shadow DOM 테스트 영역</h3>
                    <div id="shadow-container" class="sample-text"></div>
                </div>
            `;

            // 기존 데모 섹션 뒤에 추가
            const lastDemoSection = document.querySelector('.demo-section:last-of-type');
            lastDemoSection.parentNode.insertBefore(container, lastDemoSection.nextSibling);

            // Shadow DOM 생성
            const shadowContainer = document.getElementById('shadow-container');
            const shadowRoot = shadowContainer.attachShadow({ mode: 'open' });

            // Shadow DOM 내용
            shadowRoot.innerHTML = `
                <style>
                    :host {
                        display: block;
                        background: white;
                        padding: 20px;
                        border-radius: 6px;
                        border: 1px solid #ddd;
                        margin: 15px 0;
                    }
                    .shadow-content {
                        user-select: text;
                        cursor: text;
                        line-height: 1.6;
                    }
                    .shadow-title {
                        font-weight: bold;
                        color: #666eea;
                        margin-bottom: 10px;
                    }
                </style>
                <div class="shadow-content">
                    <div class="shadow-title">Shadow DOM 내부 텍스트</div>
                    <p>이 텍스트는 Shadow DOM 내부에 있습니다. 이 영역의 텍스트를 선택해도 팝업이 올바르게 표시되어야 합니다.</p>
                    <p>Shadow DOM은 웹 컴포넌트에서 사용되는 캡슐화 기술로, 일반적인 DOM 선택자로는 접근할 수 없습니다.</p>
                </div>
            `;

            // Shadow DOM 내부에도 이벤트 리스너 추가
            shadowRoot.addEventListener('mouseup', function(event) {
                const selection = window.getSelection();
                const selectedText = selection.toString().trim();

                if (selectedText.length > 0) {
                    console.log('🌑 Shadow DOM 텍스트 선택됨:', selectedText.substring(0, 50) + '...');

                    setTimeout(() => {
                        if (window.testPopupManager) {
                            window.testPopupManager.showSelectionPopup(selection, {
                                aiService: detectAIService() + ' (Shadow DOM)',
                                isShadowDOM: true
                            });

                            // Shadow DOM 테스트 결과 업데이트
                            updateShadowDOMTestResults();
                        }
                    }, 100);
                }
            });
        }

        function updateShadowDOMTestResults() {
            const results = document.getElementById('testResults');
            const shadowDOMItem = document.createElement('li');

            shadowDOMItem.innerHTML = `🌑 Shadow DOM 지원: ✓`;
            shadowDOMItem.style.color = '#28a745';
            results.querySelector('ul').appendChild(shadowDOMItem);
        }

        // AI 서비스 시뮬레이션 함수
        function simulateAIService(serviceName) {
            // URL 파라미터 변경을 통한 AI 서비스 시뮬레이션
            const url = new URL(window.location);
            url.searchParams.set('service', serviceName);
            window.history.pushState({}, '', url);

            // 페이지 새로고침 없이 서비스 감지 함수 업데이트
            window.testAIService = serviceName;

            console.log(`🤖 AI 서비스 시뮬레이션: ${serviceName}`);

            // 테스트 결과 업데이트
            const results = document.getElementById('testResults');
            const serviceItem = document.createElement('li');

            serviceItem.innerHTML = `🤖 AI 서비스 테스트: ${serviceName}`;
            serviceItem.style.color = '#28a745';
            results.querySelector('ul').appendChild(serviceItem);
        }

        // ESC 키로 팝업 닫기
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                hideTestPopup();
            }
        });
    </script>
</body>
</html>