<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>실제 확장 프로그램 테스트 페이지</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 40px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 40px;
        }
        .demo-section {
            margin-bottom: 40px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        .demo-section h3 {
            margin-top: 0;
            color: #667eea;
        }
        .sample-text {
            background: white;
            padding: 20px;
            border-radius: 6px;
            border: 1px solid #ddd;
            margin: 15px 0;
            user-select: text;
            cursor: text;
        }
        .instructions {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
            border-left: 4px solid #2196f3;
        }
        .instructions h4 {
            margin-top: 0;
            color: #1976d2;
        }
        .status {
            text-align: center;
            padding: 15px;
            border-radius: 6px;
            margin: 20px 0;
            font-weight: 500;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .test-results {
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #dee2e6;
        }
        .debug-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 300px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-height: 400px;
            overflow-y: auto;
            z-index: 10000;
        }
        .debug-panel h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .debug-log {
            font-family: monospace;
            font-size: 12px;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #e9ecef;
            max-height: 200px;
            overflow-y: auto;
        }
        .debug-log .log-entry {
            margin: 2px 0;
            padding: 2px 0;
        }
        .debug-log .log-entry.info { color: #0c5460; }
        .debug-log .log-entry.success { color: #155724; }
        .debug-log .log-entry.error { color: #721c24; }
        .debug-log .log-entry.warning { color: #856404; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🧪 실제 확장 프로그램 테스트 페이지</h1>

        <div class="status info">
            <strong>중요:</strong> 이 페이지는 로컬 서버(http://localhost)에서 실행되어야 하며, 확장 프로그램이 설치되어 있어야 합니다.
        </div>

        <div class="instructions">
            <h4>📋 테스트 방법</h4>
            <ul>
                <li>이 페이지를 로컬 서버에서 실행하세요 (예: `python -m http.server 8000`)</li>
                <li>아래 샘플 텍스트를 드래그하여 선택하세요</li>
                <li>드래그 팝업이 나타나면 저장을 클릭하세요</li>
                <li>확장 프로그램 아이콘을 클릭하여 팝업을 열고 데이터가 저장되었는지 확인하세요</li>
            </ul>
        </div>

        <div class="demo-section">
            <h3>🤖 AI 서비스 대화 예시</h3>
            <div class="sample-text">
                <p><strong>사용자:</strong> 인공지능이 현대 사회에 미치는 영향에 대해 설명해주세요.</p>
                <p><strong>AI Assistant:</strong> 인공지능은 현대 사회에 다방면으로 영향을 미치고 있습니다. 첫째, 업무 자동화를 통해 생산성을 크게 향상시키고 있습니다. 둘째, 의료, 교육, 교통 등 다양한 분야에서 혁신적인 변화를 주도하고 있습니다. 셋째, 개인화된 서비스를 제공하여 사용자 경험을 개선하고 있습니다.</p>
                <p>하지만 동시에 일자리 대체, 데이터 프라이버시, 편향성 등의 문제도 제기되고 있습니다. 따라서 인공지능의 발전은 기술적 진보와 함께 사회적, 윤리적 고민이 병행되어야 할 것입니다.</p>
            </div>
        </div>

        <div class="demo-section">
            <h3>💡 아이디어 발상 예시</h3>
            <div class="sample-text">
                <p><strong>프로젝트 아이디어:</strong> AI 기반 개인화 학습 플랫폼</p>
                <p>사용자의 학습 스타일과 진도를 분석하여 최적의 학습 경로를 제안하는 시스템입니다. 각 사용자별로 맞춤형 콘텐츠를 추천하고, 학습 효율을 실시간으로 모니터링하며, 필요에 따라 학습 전략을 동적으로 조정합니다.</p>
                <p>주요 기능으로는 학습 패턴 분석, 콘텐츠 추천 알고리즘, 진행률 시각화, 성과 예측 등이 포함됩니다. 이는 특히 원격 학습과 자기주도 학습 환경에서 큰 효과를 발휘할 수 있습니다.</p>
            </div>
        </div>

        <div class="demo-section">
            <h3>🔍 기술 설명 예시</h3>
            <div class="sample-text">
                <p><strong>머신러닝 모델 최적화 기법:</strong></p>
                <p>1. 하이퍼파라미터 튜닝: 그리드 서치, 랜덤 서치, 베이지안 최적화 등의 방법을 사용하여 모델의 성능을 극대화합니다.</p>
                <p>2. 정규화 기법: L1/L2 정규화, 드롭아웃, 조기 종료 등을 통해 과적합을 방지하고 모델의 일반화 성능을 향상시킵니다.</p>
                <p>3. 앙상블 기법: 여러 모델의 예측을 결합하여 개별 모델보다 더 뛰어난 성능을 달성합니다. 배깅, 부스팅, 스태킹 등 다양한 접근법이 있습니다.</p>
            </div>
        </div>

        <div class="test-results">
            <h4>🧪 테스트 체크리스트</h4>
            <ul id="test-checklist">
                <li>✓ 텍스트 선택 시 드래그 팝업이 나타남</li>
                <li>✓ 드래그 팝업에서 저장이 정상적으로 작동함</li>
                <li>✓ 확장 프로그램 팝업에서 저장된 데이터를 볼 수 있음</li>
                <li>✓ 두 팝업 간의 데이터가 실시간으로 동기화됨</li>
            </ul>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <button onclick="clearTestData()" style="background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">테스트 데이터 정리</button>
            <button onclick="checkExtensionStatus()" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">확장 프로그램 상태 확인</button>
        </div>
    </div>

    <!-- 디버깅 패널 -->
    <div class="debug-panel" id="debug-panel">
        <h4>🔍 디버깅 패널</h4>
        <div class="debug-log" id="debug-log"></div>
        <button onclick="clearDebugLog()" style="margin-top: 10px; padding: 5px 10px; border: 1px solid #ddd; background: #f8f9fa; border-radius: 4px; cursor: pointer;">로그 지우기</button>
    </div>

    <script>
        // 디버깅 로그 시스템
        class DebugLogger {
            constructor() {
                this.logContainer = document.getElementById('debug-log');
                this.logs = [];
            }

            log(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = {
                    timestamp,
                    message,
                    type
                };

                this.logs.push(logEntry);
                this.displayLog(logEntry);

                // 콘솔에도 출력
                console.log(`[${timestamp}] ${message}`, type);
            }

            displayLog(logEntry) {
                const logDiv = document.createElement('div');
                logDiv.className = `log-entry ${logEntry.type}`;
                logDiv.innerHTML = `<strong>[${logEntry.timestamp}]</strong> ${logEntry.message}`;

                this.logContainer.appendChild(logDiv);
                this.logContainer.scrollTop = this.logContainer.scrollHeight;

                // 로그 개수 제한
                if (this.logContainer.children.length > 50) {
                    this.logContainer.removeChild(this.logContainer.firstChild);
                }
            }

            clear() {
                this.logs = [];
                this.logContainer.innerHTML = '';
            }
        }

        const debugLogger = new DebugLogger();

        // 확장 프로그램 상태 확인
        async function checkExtensionStatus() {
            debugLogger.log('확장 프로그램 상태 확인 시작...', 'info');

            try {
                if (typeof chrome !== 'undefined' && chrome.runtime) {
                    // 확장 프로그램 ID 확인
                    debugLogger.log(`Chrome Runtime API 사용 가능`, 'info');

                    try {
                        // 백그라운드 스크립트와 통신 테스트
                        const response = await chrome.runtime.sendMessage({ action: 'getSyncStatus' });

                        if (response && response.success) {
                            debugLogger.log(`확장 프로그램과 통신 성공`, 'success');
                            debugLogger.log(`클립 수: ${response.data.clipCount}`, 'info');
                            debugLogger.log(`카테고리 수: ${response.data.categoryCount}`, 'info');
                        } else {
                            debugLogger.log(`확장 프로그램 응답 없음`, 'error');
                        }
                    } catch (error) {
                        debugLogger.log(`확장 프로그램 통신 실패: ${error.message}`, 'error');
                    }
                } else {
                    debugLogger.log(`Chrome Runtime API 사용 불가`, 'error');
                }
            } catch (error) {
                debugLogger.log(`상태 확인 실패: ${error.message}`, 'error');
            }
        }

        // 테스트 데이터 정리
        async function clearTestData() {
            debugLogger.log('테스트 데이터 정리 시작...', 'info');

            try {
                if (typeof chrome !== 'undefined' && chrome.runtime) {
                    const response = await chrome.runtime.sendMessage({ action: 'clearTestData' });

                    if (response && response.success) {
                        debugLogger.log(`테스트 데이터 정리 성공`, 'success');
                    } else {
                        debugLogger.log(`테스트 데이터 정리 실패`, 'error');
                    }
                } else {
                    debugLogger.log(`확장 프로그램 API 사용 불가`, 'error');
                }
            } catch (error) {
                debugLogger.log(`데이터 정리 실패: ${error.message}`, 'error');
            }
        }

        // 디버그 로그 지우기
        function clearDebugLog() {
            debugLogger.clear();
        }

        // 페이지 로드 시 초기화
        document.addEventListener('DOMContentLoaded', () => {
            debugLogger.log('테스트 페이지 로드됨', 'info');
            debugLogger.log(`현재 URL: ${window.location.href}`, 'info');

            // 5초 후 자동으로 확장 프로그램 상태 확인
            setTimeout(checkExtensionStatus, 5000);

            // 텍스트 선택 이벤트 리스너
            document.addEventListener('mouseup', (event) => {
                const selection = window.getSelection();
                const selectedText = selection.toString().trim();

                if (selectedText.length > 0) {
                    debugLogger.log(`텍스트 선택됨: "${selectedText.substring(0, 50)}..."`, 'info');
                }
            });
        });

        // 확장 프로그램 메시지 리스너
        if (typeof chrome !== 'undefined' && chrome.runtime) {
            chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
                debugLogger.log(`메시지 수신: ${request.action}`, 'info');

                if (request.action === 'storageChanged') {
                    debugLogger.log(`스토리지 변경 감지: ${request.dataType}`, 'success');
                }
            });
        }
    </script>
</body>
</html>