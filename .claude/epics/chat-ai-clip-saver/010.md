---
name: Pop-up Integration & Event Handling
status: open
created: 2025-09-29T07:00:00Z
updated: 2025-09-29T07:00:00Z
github: [Will be updated when synced to GitHub]
depends_on: ["009.md"]
parallel: false
conflicts_with: []
---
# Task: Pop-up Integration & Event Handling

## Description
확장 팝업 UI와 기존 시스템을 통합하고, 텍스트 선택 감지, 팝업 표시, 저장 처리 등의 전체 이벤트 흐름을 구현합니다.

## Acceptance Criteria
### Must-Have
- [ ] **텍스트 선택 감지**: 드래그 후 마우스 릴리즈 시 팝업 표시
- [ ] **자동 제목 생성**: 첫 30-40자 + | + AI 서비스명
- [ ] **미리보기 텍스트**: 첫 줄 제외 후 80-100자 표시
- [ ] **저장 로직 연동**: 팝업에서 저장 → ClipManager 호출
- [ ] **외부 클릭 닫기**: 팝업 외부 클릭 시 닫기
- [ ] **ESC 키 닫기**: ESC 키로 팝업 닫기
- [ ] **토스트 알림**: 저장 완료 후 "Saved ✓" 표시

### Nice-to-Have
- [ ] **AI 서비스 감지**: ChatGPT, Claude 등 자동 감지
- [ ] **최근 카테고리**: 최근 사용 카테고리 기억 및 제안
- [ ] **단축키**: Ctrl/Cmd+Shift+S로 팝업 표시

## Implementation Details
### 주요 통합 포인트
1. **Content Script 수정**: 텍스트 선택 감지 → 팝업 표시
2. **PopupManager**: 팝업 생명주기 관리
3. **Event Handling**: 사용자 인터랙션 처리
4. **Data Flow**: 선택 텍스트 → 팝업 → 저장 처리

### 이벤트 흐름
```
텍스트 드래그 → mouseup 이벤트 →
  팝업 생성 → 위치 계산 → 표시 →
  사용자 입력 → 저장 버튼 클릭 →
  ClipManager.saveClip() → 토스트 표시 → 팝업 닫기
```

### 핵심 함수
- `showSelectionPopup()`: 선택 영역 기반 팝업 표시
- `hideSelectionPopup()`: 팝업 숨기기
- `generateAutoTitle()`: 자동 제목 생성
- `generatePreviewText()`: 미리보기 텍스트 생성
- `detectAIService()`: AI 서비스 감지

## Dependencies
### 외부 의존성
- Chrome Extension API
- DOM API

### 내부 의존성
- content.js (텍스트 선택 감지)
- PopupManager (팝업 관리)
- ClipManager (저장 로직)
- CategoryManager (카테고리 목록)
- I18nManager (다국어)

## Technical Notes
### 텍스트 처리
- `window.getSelection()`으로 선택 텍스트 가져오기
- 텍스트 전처리 (공백, 줄바꿈 정리)
- AI 서비스 URL 패턴 매칭

### 이벤트 관리
- 이벤트 버블링 방지
- cleanup 함수로 이벤트 리스너 제거
- 중복 이벤트 방지

### 데이터 검증
- 제목 길이 검증 (최대 60자)
- 필수 필드 검증
- 카테고리 선택 검증

## Success Criteria
### 기술적 성공 기준
- [ ] 텍스트 선택 후 즉시 팝업 표시
- [ ] 자동 제목 생성 정확도 95% 이상
- [ ] 저장 성공률 98% 이상
- [ ] 모든 이벤트가 정상적으로 처리됨

### 품질 기준
- [ ] 성능: 전체 과정 <200ms
- [ ] 안정성: 메모리 누수 없음
- [ ] 호환성: 주요 AI 서비스에서 동작
- [ ] 사용성: 직관적인 인터랙션

## Test Plan
### 통합 테스트
- 실제 AI 서비스 페이지에서 테스트
- 다양한 텍스트 선택 시나리오
- 예외 상황 처리 테스트

### 사용성 테스트
- 사용자 피드백 수집
- A/B 테스트를 통한 UX 개선
- 접근성 테스트

## Error Handling
- 예외 상황 처리 (빈 선택, 너무 긴 텍스트 등)
- 사용자 친화적인 에러 메시지
- graceful degradation