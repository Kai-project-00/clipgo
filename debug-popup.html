<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClipGo Popup Debug Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-text {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 2px solid #ddd;
            user-select: text;
            cursor: text;
        }
        .debug-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 300px;
            background: white;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-height: 400px;
            overflow-y: auto;
        }
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
        .log-entry.info { background: #e3f2fd; }
        .log-entry.success { background: #e8f5e8; }
        .log-entry.error { background: #ffebee; }
        .log-entry.warning { background: #fff3e0; }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 6px;
            font-weight: bold;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.info { background: #d1ecf1; color: #0c5460; }
        button {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            background: #007bff;
            color: white;
        }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>ğŸ§ª ClipGo Popup Debug Test</h1>

    <div class="status info">
        <strong>í…ŒìŠ¤íŠ¸ ëª©ì :</strong> í…ìŠ¤íŠ¸ ì„ íƒ ì‹œ íŒì—…ì´ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸í•˜ê³  ë¬¸ì œë¥¼ ì§„ë‹¨í•©ë‹ˆë‹¤.
    </div>

    <div class="test-text" id="test-text-1">
        <h3>ğŸ¤– AI ëŒ€í™” ì˜ˆì‹œ 1</h3>
        <p>ì´ê²ƒì€ í…ŒìŠ¤íŠ¸ìš© í…ìŠ¤íŠ¸ì…ë‹ˆë‹¤. ì´ í…ìŠ¤íŠ¸ë¥¼ ë“œë˜ê·¸í•˜ì—¬ ì„ íƒí•˜ë©´ íŒì—…ì´ ë‚˜íƒ€ë‚˜ì•¼ í•©ë‹ˆë‹¤.</p>
        <p>ClipGo í™•ì¥ í”„ë¡œê·¸ë¨ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•œë‹¤ë©´, í…ìŠ¤íŠ¸ë¥¼ ì„ íƒí–ˆì„ ë•Œ ì €ì¥ íŒì—…ì´ í‘œì‹œë©ë‹ˆë‹¤.</p>
    </div>

    <div class="test-text" id="test-text-2">
        <h3>ğŸ’¡ ì•„ì´ë””ì–´ ë°œìƒ ì˜ˆì‹œ</h3>
        <p>ë‘ ë²ˆì§¸ í…ŒìŠ¤íŠ¸ í…ìŠ¤íŠ¸ì…ë‹ˆë‹¤. ì—¬ëŸ¬ í…ìŠ¤íŠ¸ë¥¼ ì„ íƒí•´ë³´ë©° íŒì—…ì´ ì¼ê´€ë˜ê²Œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p>
        <p>ë¨¸ì‹ ëŸ¬ë‹ê³¼ ë”¥ëŸ¬ë‹ì˜ ì°¨ì´ì ì„ ì´í•´í•˜ëŠ” ê²ƒì€ ì¤‘ìš”í•©ë‹ˆë‹¤. ë¨¸ì‹ ëŸ¬ë‹ì€ ë°ì´í„°ì—ì„œ íŒ¨í„´ì„ í•™ìŠµí•˜ëŠ” ì•Œê³ ë¦¬ì¦˜ì˜ ì—°êµ¬ì…ë‹ˆë‹¤.</p>
    </div>

    <div class="debug-panel">
        <h3>ğŸ” ë””ë²„ê·¸ íŒ¨ë„</h3>
        <button onclick="checkExtensionStatus()">í™•ì¥ ìƒíƒœ í™•ì¸</button>
        <button onclick="checkScriptsLoaded()">ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© í™•ì¸</button>
        <button onclick="testTextSelection()">í…ìŠ¤íŠ¸ ì„ íƒ í…ŒìŠ¤íŠ¸</button>
        <button onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
        <div id="debug-log"></div>
    </div>

    <script>
        let debugLog = [];

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = { timestamp, message, type };
            debugLog.push(logEntry);

            const logDiv = document.createElement('div');
            logDiv.className = `log-entry ${type}`;
            logDiv.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;

            const logContainer = document.getElementById('debug-log');
            logContainer.appendChild(logDiv);
            logContainer.scrollTop = logContainer.scrollHeight;

            console.log(`[ClipGo Debug] ${message}`, type);
        }

        function checkExtensionStatus() {
            log('í™•ì¥ í”„ë¡œê·¸ë¨ ìƒíƒœ í™•ì¸ ì‹œì‘...', 'info');

            if (typeof chrome !== 'undefined' && chrome.runtime) {
                log('âœ… Chrome Runtime API ì‚¬ìš© ê°€ëŠ¥', 'success');

                // í™•ì¥ í”„ë¡œê·¸ë¨ ID í™•ì¸
                if (chrome.runtime.id) {
                    log(`âœ… í™•ì¥ í”„ë¡œê·¸ë¨ ID: ${chrome.runtime.id}`, 'success');
                } else {
                    log('âŒ í™•ì¥ í”„ë¡œê·¸ë¨ IDë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ì—†ìŒ', 'error');
                }

                // ë°±ê·¸ë¼ìš´ë“œ ìŠ¤í¬ë¦½íŠ¸ì™€ í†µì‹  í…ŒìŠ¤íŠ¸
                chrome.runtime.sendMessage({ action: 'ping' }, (response) => {
                    if (chrome.runtime.lastError) {
                        log(`âŒ ë°±ê·¸ë¼ìš´ë“œ ìŠ¤í¬ë¦½íŠ¸ í†µì‹  ì‹¤íŒ¨: ${chrome.runtime.lastError.message}`, 'error');
                    } else if (response) {
                        log('âœ… ë°±ê·¸ë¼ìš´ë“œ ìŠ¤í¬ë¦½íŠ¸ í†µì‹  ì„±ê³µ', 'success');
                    } else {
                        log('âš ï¸ ë°±ê·¸ë¼ìš´ë“œ ìŠ¤í¬ë¦½íŠ¸ ì‘ë‹µ ì—†ìŒ', 'warning');
                    }
                });
            } else {
                log('âŒ Chrome Runtime API ì‚¬ìš© ë¶ˆê°€', 'error');
            }
        }

        function checkScriptsLoaded() {
            log('ìŠ¤í¬ë¦½íŠ¸ ë¡œë”© ìƒíƒœ í™•ì¸...', 'info');

            // í•„ìˆ˜ í´ë˜ìŠ¤ í™•ì¸
            const requiredClasses = [
                'StorageManager',
                'CategoryManager',
                'ClipManager',
                'PopupManager',
                'TextSelectionHandler'
            ];

            let allLoaded = true;
            requiredClasses.forEach(className => {
                if (typeof window[className] !== 'undefined') {
                    log(`âœ… ${className} ë¡œë“œë¨`, 'success');
                } else {
                    log(`âŒ ${className} ë¡œë“œë˜ì§€ ì•ŠìŒ`, 'error');
                    allLoaded = false;
                }
            });

            if (allLoaded) {
                log('âœ… ëª¨ë“  í•„ìˆ˜ í´ë˜ìŠ¤ê°€ ë¡œë“œë¨', 'success');

                // TextSelectionHandler ì¸ìŠ¤í„´ìŠ¤ í™•ì¸
                if (window.textSelectionHandler) {
                    log('âœ… TextSelectionHandler ì¸ìŠ¤í„´ìŠ¤ ìƒì„±ë¨', 'success');
                } else {
                    log('âŒ TextSelectionHandler ì¸ìŠ¤í„´ìŠ¤ ìƒì„±ë˜ì§€ ì•ŠìŒ', 'error');
                }
            }
        }

        function testTextSelection() {
            log('í…ìŠ¤íŠ¸ ì„ íƒ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');

            // í…ŒìŠ¤íŠ¸ í…ìŠ¤íŠ¸ ê°•ì œ ì„ íƒ
            const testElement = document.getElementById('test-text-1');
            const range = document.createRange();
            range.selectNodeContents(testElement);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);

            log('í…ŒìŠ¤íŠ¸ í…ìŠ¤íŠ¸ë¥¼ ê°•ì œë¡œ ì„ íƒí–ˆìŠµë‹ˆë‹¤', 'info');

            // ìˆ˜ë™ìœ¼ë¡œ mouseup ì´ë²¤íŠ¸ ë°œìƒ
            const mouseEvent = new MouseEvent('mouseup', {
                bubbles: true,
                cancelable: true,
                view: window
            });

            testElement.dispatchEvent(mouseEvent);
            log('mouseup ì´ë²¤íŠ¸ë¥¼ ê°•ì œë¡œ ë°œìƒì‹œì¼°ìŠµë‹ˆë‹¤', 'info');
        }

        function clearLog() {
            debugLog = [];
            document.getElementById('debug-log').innerHTML = '';
            log('ë¡œê·¸ê°€ ì§€ì›Œì¡ŒìŠµë‹ˆë‹¤', 'info');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ë¡œê¹…
        document.addEventListener('DOMContentLoaded', () => {
            log('ë””ë²„ê·¸ í˜ì´ì§€ ë¡œë“œë¨', 'success');
            log(`í˜„ì¬ URL: ${window.location.href}`, 'info');
            log(`User Agent: ${navigator.userAgent}`, 'info');

            // í™•ì¥ í”„ë¡œê·¸ë¨ ìƒíƒœ ìë™ í™•ì¸
            setTimeout(checkExtensionStatus, 1000);
            setTimeout(checkScriptsLoaded, 2000);
        });

        // í…ìŠ¤íŠ¸ ì„ íƒ ì´ë²¤íŠ¸ ëª¨ë‹ˆí„°ë§
        document.addEventListener('mouseup', (e) => {
            const selection = window.getSelection();
            const selectedText = selection.toString().trim();

            if (selectedText.length > 0) {
                log(`í…ìŠ¤íŠ¸ ì„ íƒ ê°ì§€: "${selectedText.substring(0, 50)}..."`, 'info');

                // íŒì—…ì´ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸
                setTimeout(() => {
                    const popup = document.querySelector('.chat-ai-popup-overlay');
                    if (popup) {
                        log('âœ… íŒì—…ì´ í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                    } else {
                        log('âŒ íŒì—…ì´ í‘œì‹œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', 'error');
                    }
                }, 500);
            }
        }, true);
    </script>
</body>
</html>