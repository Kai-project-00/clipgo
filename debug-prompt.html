<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClipGo ì¦‰ì‹œ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .test-text {
            background: white;
            padding: 30px;
            margin: 20px 0;
            border-radius: 8px;
            border: 2px solid #007bff;
            user-select: text;
            cursor: text;
            font-size: 16px;
            line-height: 1.6;
        }
        .console {
            background: #1e1e1e;
            color: #fff;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            margin: 20px 0;
            height: 300px;
            overflow-y: auto;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn:hover { background: #0056b3; }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 6px;
            font-weight: bold;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>ğŸ§ª ClipGo ì¦‰ì‹œ ë””ë²„ê¹… í…ŒìŠ¤íŠ¸</h1>

    <div class="status info">
        <strong>ëª©í‘œ:</strong> í…ìŠ¤íŠ¸ ì„ íƒ ì‹œ íŒì—…ì´ í‘œì‹œë˜ì§€ ì•ŠëŠ” ë¬¸ì œë¥¼ ì¦‰ì‹œ ì§„ë‹¨í•©ë‹ˆë‹¤.
    </div>

    <div class="test-text" id="test-text">
        <h3>ğŸ“ í…ŒìŠ¤íŠ¸ìš© í…ìŠ¤íŠ¸ì…ë‹ˆë‹¤</h3>
        <p>ì´ í…ìŠ¤íŠ¸ë¥¼ ë§ˆìš°ìŠ¤ë¡œ ë“œë˜ê·¸í•˜ì—¬ ì„ íƒí•´ë³´ì„¸ìš”. ClipGo í™•ì¥ í”„ë¡œê·¸ë¨ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•œë‹¤ë©´ ì €ì¥ íŒì—…ì´ ë‚˜íƒ€ë‚˜ì•¼ í•©ë‹ˆë‹¤.</p>
        <p>ì¸ê³µì§€ëŠ¥ê³¼ ë¨¸ì‹ ëŸ¬ë‹ì€ í˜„ëŒ€ ê¸°ìˆ ì˜ í•µì‹¬ì…ë‹ˆë‹¤. ë”¥ëŸ¬ë‹ì€ ì‹ ê²½ë§ì„ ê¸°ë°˜ìœ¼ë¡œ í•œ ë¨¸ì‹ ëŸ¬ë‹ì˜ í•œ ë¶„ì•¼ë¡œì„œ, ì´ë¯¸ì§€ ì¸ì‹, ìì—°ì–´ ì²˜ë¦¬, ìŒì„± ì¸ì‹ ë“± ë‹¤ì–‘í•œ ë¶„ì•¼ì—ì„œ í˜ì‹ ì ì¸ ì„±ê³¼ë¥¼ ë‚´ê³  ìˆìŠµë‹ˆë‹¤.</p>
    </div>

    <div>
        <button class="btn" onclick="checkEverything()">ì „ì²´ ìƒíƒœ í™•ì¸</button>
        <button class="btn" onclick="forcePopup()">íŒì—… ê°•ì œ í‘œì‹œ</button>
        <button class="btn" onclick="testSelection()">ì„ íƒ í…ŒìŠ¤íŠ¸</button>
        <button class="btn" onclick="clearConsole()">ì½˜ì†” ì§€ìš°ê¸°</button>
    </div>

    <div class="console" id="console"></div>

    <script>
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const color = type === 'error' ? '#ff6b6b' : type === 'success' ? '#51cf66' : '#74c0fc';
            const consoleDiv = document.getElementById('console');
            consoleDiv.innerHTML += `<div style="color: ${color}; margin: 2px 0;">[${timestamp}] ${message}</div>`;
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
            console.log(`[ClipGo Debug] ${message}`);
        }

        function checkEverything() {
            log('=== ì „ì²´ ìƒíƒœ í™•ì¸ ì‹œì‘ ===', 'info');

            // 1. Chrome API í™•ì¸
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                log('âœ… Chrome Runtime API ì‚¬ìš© ê°€ëŠ¥', 'success');

                if (chrome.runtime.id) {
                    log(`âœ… í™•ì¥ í”„ë¡œê·¸ë¨ ID: ${chrome.runtime.id}`, 'success');
                } else {
                    log('âŒ í™•ì¥ í”„ë¡œê·¸ë¨ ID ì—†ìŒ', 'error');
                }

                // ë°±ê·¸ë¼ìš´ë“œ ìŠ¤í¬ë¦½íŠ¸ í†µì‹  í…ŒìŠ¤íŠ¸
                chrome.runtime.sendMessage({ action: 'ping' }, (response) => {
                    if (chrome.runtime.lastError) {
                        log(`âŒ ë°±ê·¸ë¼ìš´ë“œ ìŠ¤í¬ë¦½íŠ¸ í†µì‹  ì‹¤íŒ¨: ${chrome.runtime.lastError.message}`, 'error');
                    } else {
                        log('âœ… ë°±ê·¸ë¼ìš´ë“œ ìŠ¤í¬ë¦½íŠ¸ í†µì‹  ì„±ê³µ', 'success');
                    }
                });
            } else {
                log('âŒ Chrome Runtime API ì‚¬ìš© ë¶ˆê°€', 'error');
            }

            // 2. í•„ìˆ˜ í´ë˜ìŠ¤ í™•ì¸
            const classes = ['StorageManager', 'CategoryManager', 'ClipManager', 'PopupManager', 'TextSelectionHandler'];
            classes.forEach(className => {
                if (typeof window[className] !== 'undefined') {
                    log(`âœ… ${className} í´ë˜ìŠ¤ ë¡œë“œë¨`, 'success');
                } else {
                    log(`âŒ ${className} í´ë˜ìŠ¤ ì—†ìŒ`, 'error');
                }
            });

            // 3. ì¸ìŠ¤í„´ìŠ¤ í™•ì¸
            if (window.textSelectionHandler) {
                log('âœ… TextSelectionHandler ì¸ìŠ¤í„´ìŠ¤ ìˆìŒ', 'success');
            } else {
                log('âŒ TextSelectionHandler ì¸ìŠ¤í„´ìŠ¤ ì—†ìŒ', 'error');
            }

            // 4. CSS í™•ì¸
            const popupOverlay = document.querySelector('.chat-ai-popup-overlay');
            if (popupOverlay) {
                log('âš ï¸ íŒì—… ì˜¤ë²„ë ˆì´ê°€ ì´ë¯¸ ì¡´ì¬í•¨', 'error');
            } else {
                log('âœ… íŒì—… ì˜¤ë²„ë ˆì´ ì—†ìŒ (ì •ìƒ)', 'success');
            }

            log('=== ì „ì²´ ìƒíƒœ í™•ì¸ ì™„ë£Œ ===', 'info');
        }

        function forcePopup() {
            log('íŒì—… ê°•ì œ ìƒì„± ì‹œë„...', 'info');

            try {
                if (window.PopupManager) {
                    const selection = window.getSelection();
                    if (selection.rangeCount > 0) {
                        const popupManager = new PopupManager();
                        popupManager.showSelectionPopup(selection, {
                            aiService: 'debug',
                            isShadowDOM: false
                        });
                        log('âœ… íŒì—… ê°•ì œ ìƒì„± ëª…ë ¹ ì „ì†¡', 'success');
                    } else {
                        log('âŒ ì„ íƒëœ í…ìŠ¤íŠ¸ ì—†ìŒ', 'error');
                    }
                } else {
                    log('âŒ PopupManager í´ë˜ìŠ¤ ì—†ìŒ', 'error');
                }
            } catch (error) {
                log(`âŒ íŒì—… ìƒì„± ì‹¤íŒ¨: ${error.message}`, 'error');
                log(`ìŠ¤íƒ: ${error.stack}`, 'error');
            }
        }

        function testSelection() {
            log('í…ìŠ¤íŠ¸ ì„ íƒ ê°•ì œ í…ŒìŠ¤íŠ¸...', 'info');

            const testElement = document.getElementById('test-text');
            const range = document.createRange();
            range.selectNodeContents(testElement);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);

            log('âœ… í…ìŠ¤íŠ¸ ê°•ì œ ì„ íƒ ì™„ë£Œ', 'success');

            // mouseup ì´ë²¤íŠ¸ ê°•ì œ ë°œìƒ
            const mouseEvent = new MouseEvent('mouseup', {
                bubbles: true,
                cancelable: true,
                view: window
            });

            testElement.dispatchEvent(mouseEvent);
            log('âœ… mouseup ì´ë²¤íŠ¸ ë°œìƒ ì™„ë£Œ', 'success');

            // 1ì´ˆ í›„ íŒì—… í™•ì¸
            setTimeout(() => {
                const popup = document.querySelector('.chat-ai-popup-overlay');
                if (popup) {
                    log('âœ… íŒì—…ì´ í‘œì‹œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                } else {
                    log('âŒ íŒì—…ì´ í‘œì‹œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤', 'error');
                }
            }, 1000);
        }

        function clearConsole() {
            document.getElementById('console').innerHTML = '';
            log('ì½˜ì†”ì´ ì§€ì›Œì¡ŒìŠµë‹ˆë‹¤', 'info');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í™•ì¸
        window.addEventListener('load', () => {
            log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ', 'success');
            setTimeout(checkEverything, 1000);
        });

        // í…ìŠ¤íŠ¸ ì„ íƒ ì´ë²¤íŠ¸ ëª¨ë‹ˆí„°ë§
        document.addEventListener('mouseup', (e) => {
            const selection = window.getSelection();
            const selectedText = selection.toString().trim();

            if (selectedText.length > 0) {
                log(`í…ìŠ¤íŠ¸ ì„ íƒ ê°ì§€: "${selectedText.substring(0, 30)}..."`, 'info');

                // 500ms í›„ íŒì—… í™•ì¸
                setTimeout(() => {
                    const popup = document.querySelector('.chat-ai-popup-overlay');
                    if (popup) {
                        log('âœ… íŒì—… ê°ì§€ë¨!', 'success');
                    } else {
                        log('âŒ íŒì—…ì´ ìƒì„±ë˜ì§€ ì•ŠìŒ', 'error');

                        // ë””ë²„ê¹… ì •ë³´ ì¶œë ¥
                        if (window.textSelectionHandler) {
                            log('TextSelectionHandler ìˆìŒ', 'info');
                        } else {
                            log('TextSelectionHandler ì—†ìŒ', 'error');
                        }

                        if (window.PopupManager) {
                            log('PopupManager í´ë˜ìŠ¤ ìˆìŒ', 'info');
                        } else {
                            log('PopupManager í´ë˜ìŠ¤ ì—†ìŒ', 'error');
                        }
                    }
                }, 500);
            }
        }, true);
    </script>
</body>
</html>